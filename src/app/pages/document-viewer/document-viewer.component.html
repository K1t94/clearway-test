<div class="document-viewer" #container>
  <div class="toolbar">
    <div class="zoom-controls">
      <button (click)="zoomOut()" [disabled]="scale() <= 0.5">-</button>
      <span>{{ (scale() * 100).toFixed(0) }}%</span>
      <button (click)="zoomIn()" [disabled]="scale() >= 3">+</button>
    </div>

    <button class="save-btn" (click)="saveAnnotations()">
      üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
    </button>

    <button class="add-annotation-btn" (click)="toggleAddMode()"
            [class.active]="isAddMode()">
      üìù {{ isAddMode() ? '–û—Ç–º–µ–Ω–∏—Ç—å' : '–î–æ–±–∞–≤–∏—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é' }}
    </button>

    @if (documentId() && document()) {
      <div class="document-info">
        –î–æ–∫—É–º–µ–Ω—Ç: {{ documentId() }} ‚Ä¢ {{ document()!.pages.length }} —Å—Ç—Ä–∞–Ω–∏—Ü
      </div>
    }
  </div>

  @if (document()) {
    <div class="document-container"
         [style.transform]="'scale(' + scale() + ')'"
         [style.transform-origin]="'top center'"
         (dblclick)="onDocumentDoubleClick($event)">

      @for (page of document()!.pages; track page.pageNumber; let pageIndex = $index) {
        <div class="page-container" [attr.data-page]="pageIndex + 1">
          <div class="page-wrapper">
            <img [src]="page.imageUrl"
                 [alt]="'–°—Ç—Ä–∞–Ω–∏—Ü–∞ ' + (pageIndex + 1)"
                 class="page-image"
                 [style.width.px]="page.width"
                 [style.height.px]="page.height"
                 loading="lazy">

            <div class="annotations-layer">
              @for (annotation of annotationsByPage()[pageIndex]; track annotation.id) {
                <app-annotation
                  [positionX]="annotation.position.x"
                  [positionY]="annotation.position.y"
                  [backgroundColor]="annotation.style.backgroundColor"
                  [textSize]="annotation.style.fontSize"
                  [textColor]="annotation.style.color"
                  [text]="annotation.text"
                  [scale]="scale()"
                  (moved)="onAnnotationMoved($event, annotation.id, pageIndex)"
                  (deleted)="onAnnotationDeleted(annotation.id)">
                </app-annotation>
              }
            </div>
          </div>
        </div>
      }
    </div>
  } @else {
    <div class="loading">
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞...</p>
    </div>
  }

  @if (isAddMode()) {
    <div class="add-mode-indicator">
      <p>–î–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é</p>
      <small>–ò–ª–∏ –Ω–∞–∂–º–∏—Ç–µ ESC –¥–ª—è –æ—Ç–º–µ–Ω—ã</small>
    </div>
  }
</div>
